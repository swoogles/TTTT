plugins {
  id 'org.unbroken-dome.test-sets' version '1.5.0'
}

apply plugin: 'java'
apply plugin: 'jacoco'

repositories {                                                                                                                                                            
  mavenCentral()
}    

test {
  useTestNG()
}

testSets {
    integrationTest
}

integrationTest {
  useTestNG()
  testClassesDir = file('build/classes/java/integrationTest')
}

dependencies {
		testCompile "org.testng:testng:6.14+"
    testCompile group: 'org.mockito', name: 'mockito-core', version: '2.19.0'
}

jacocoTestReport {
    reports {
        xml.enabled true
        html.enabled false
    }
}

check {
  dependsOn integrationTest
  dependsOn jacocoTestReport
}

// Log final numbers. They get hidden otherwise.
test {
	testLogging {
		afterSuite { desc, result ->
			if (!desc.parent) { // will match the outermost suite
				println "Results: ${result.resultType} (${result.testCount} tests, ${result.successfulTestCount} successes, ${result.failedTestCount} failures, ${result.skippedTestCount} skipped)"
			}
		}
	}
}
