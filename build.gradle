plugins {
  // id "nebula.integtest" version "4.0.1"
  id 'org.unbroken-dome.test-sets' version '1.5.0'
}

apply plugin: 'java'

apply plugin: 'war'
apply plugin: 'jacoco'

repositories {                                                                                                                                                            
  mavenCentral()
}    

test {
  useTestNG()
}

testSets {
    integrationTest
}

integrationTest {
  useTestNG()
  testClassesDir = file('build/classes/java/integrationTest')
  // testClassesDir = file('out/integrationTest/classes')
  // classpath = sourceSets.integrationTest.runtimeClasspath
  // classpath += output + compileClasspath
    // srcDirs = ['src/integrationTest/java']
		// resourceDirs = ['src/integrationTest/resources']
		// classpath += test.output
		// runtimeClasspath += main.output + test.output
}

dependencies {
    compile 'com.netflix.nebula:nebula-project-plugin:4.0.1'
    compile group: 'javax.json', name: 'javax.json-api', version: '1.1.2'
    providedCompile "javax:javaee-api:7.0"
    compile 'org.apache.commons:commons-lang3:3.4'
		testCompile "org.testng:testng:6.14+"
    testCompile group: 'org.mockito', name: 'mockito-core', version: '2.19.0'
}

// apply plugin: "nebula.integtest"
// apply plugin: 'nebula.integtest-standalone'

/*
sourceSets {
  integrationTest {
    java.srcDir file('src/integrationTest/java')
      // compileClasspath += sourceSets.main.output + configurations.testRuntime
      // runtimeClasspath += output + compileClasspath
      // classpath = sourceSets.integTest.runtimeClasspath
  }
}
*/

jacocoTestReport {
    reports {
        xml.enabled true
        html.enabled false
    }
}


check {
  dependsOn integrationTest
  dependsOn jacocoTestReport
}

